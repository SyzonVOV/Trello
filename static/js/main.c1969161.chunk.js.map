{"version":3,"sources":["styles.ts","utils/arrayUtils.ts","state/appStateReducer.ts","utils/moveItem.ts","withInitialState.tsx","state/AppStateContext.tsx","api.ts","utils/isHidden.ts","state/actions.ts","utils/useItemDrag.ts","components/Card/Card.tsx","components/NewItemForm/NewItemForm.tsx","utils/useFocus.ts","components/AddNewItem/AddNewItem.tsx","components/Column/Column.tsx","CustomDragLayer.tsx","App.tsx","index.tsx"],"names":["DragPreviewContainer","styled","div","props","isPreview","undefined","isHidden","AppContainer","ColumnContainer","ColumnTitle","CardContainer","AddItemButton","button","dark","NewItemFormContainer","NewItemButton","NewItemInput","input","CustomDragLayerContainer","DragPreviewWrapper","attrs","position","x","y","style","transform","rotate360","keyframes","FlexContainer","Spinner","findItemIndexById","items","id","findIndex","item","appStateReducer","draft","action","type","lists","push","uuidv4","text","payload","tasks","listId","targetListIndex","draggedId","hoverId","dragIndex","hoverIndex","array","from","to","startIndex","length","splice","moveItem","draggedItemId","hoveredItemId","sourceColumnId","targetColumnId","sourceListIndex","draggedItem","appData","WrappedComponent","AppStateContext","createContext","AppStateProvider","children","initialState","useImmerReducer","state","dispatch","useEffect","fetch","process","method","headers","Accept","body","JSON","stringify","then","response","ok","json","Error","catch","error","console","log","Provider","value","getTasksByListId","find","list","useState","setInitialState","isLoading","setIsLoading","a","data","fetchInitialState","message","useAppState","useContext","itemType","Boolean","setDraggedItem","moveTask","useItemDrag","useDrag","end","drag","preview","getEmptyImage","captureDraggingState","Card","columnId","ref","useRef","useDrop","accept","hover","throttle","drop","NewItemForm","onAdd","setText","inputRef","useLayoutEffect","current","focus","useFocus","onChange","e","target","onKeyPress","ev","key","onClick","AddNewItem","showForm","setShowForm","toggleButtonText","Column","map","task","addTask","CustomDragLayer","currentOffset","useDragLayer","monitor","getSourceClientOffset","App","addList","ReactDOM","render","StrictMode","DndProvider","backend","Backend","document","getElementById"],"mappings":"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","file":"static/js/main.c1969161.chunk.js","sourcesContent":["import styled, { keyframes } from 'styled-components'\r\n\r\ninterface AddItemButtonProps {\r\n  dark?: boolean\r\n}\r\n\r\ninterface DragPreviewContainerProps {\r\n  isHidden?: boolean\r\n  isPreview?: boolean\r\n}\r\n\r\ntype DragPreviewWrapperProps = {\r\n  position: {\r\n    x: number\r\n    y: number\r\n  }\r\n}\r\n\r\nexport const DragPreviewContainer = styled.div<DragPreviewContainerProps>`\r\n  transform: ${ (props) =>\r\n          props.isPreview ? 'rotate(5deg)' : undefined };\r\n  opacity: ${ props => (props.isHidden ? 0 : 1) };\r\n`\r\n\r\nexport const AppContainer = styled.div`\r\n  align-items: flex-start;\r\n  background-color: #3179ba;\r\n  display: flex;\r\n  flex-direction: row;\r\n  height: 100%;\r\n  padding: 20px;\r\n  width: 100%;\r\n`\r\n\r\nexport const ColumnContainer = styled( DragPreviewContainer )`\r\n  background-color: #ebecf0;\r\n  width: 300px;\r\n  min-height: 40px;\r\n  margin-right: 20px;\r\n  border-radius: 3px;\r\n  padding: 8px 8px;\r\n  flex-grow: 0;\r\n`\r\n\r\nexport const ColumnTitle = styled.div`\r\n  padding: 6px 16px 12px;\r\n  font-weight: bold;\r\n`\r\n\r\nexport const CardContainer = styled( DragPreviewContainer )`\r\n  background-color: #fff;\r\n  cursor: pointer;\r\n  margin-bottom: 0.5rem;\r\n  padding: 0.5rem 1rem;\r\n  max-width: 300px;\r\n  border-radius: 3px;\r\n  box-shadow: #091e4240 0 1px 0 0;\r\n`\r\n\r\nexport const AddItemButton = styled.button<AddItemButtonProps>`\r\n  background-color: #ffffff3d;\r\n  border-radius: 3px;\r\n  border: none;\r\n  color: ${ props => (props.dark ? '#000' : '#fff') };\r\n  cursor: pointer;\r\n  max-width: 300px;\r\n  padding: 10px 12px;\r\n  text-align: left;\r\n  transition: background 85ms ease-in;\r\n  width: 100%;\r\n\r\n  &:hover {\r\n    background-color: #ffffff52;\r\n  }\r\n`\r\n\r\nexport const NewItemFormContainer = styled.div`\r\n  max-width: 300px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  width: 100%;\r\n  align-items: flex-start;\r\n`\r\n\r\nexport const NewItemButton = styled.button`\r\n  background-color: #5aac44;\r\n  border-radius: 3px;\r\n  border: none;\r\n  box-shadow: none;\r\n  color: #fff;\r\n  padding: 6px 12px;\r\n  text-align: center;\r\n`\r\n\r\nexport const NewItemInput = styled.input`\r\n  border-radius: 3px;\r\n  border: none;\r\n  box-shadow: #091e4240 0 1px 0 0;\r\n  margin-bottom: 0.5rem;\r\n  padding: 0.5rem 1rem;\r\n  width: 100%;\r\n`\r\n\r\nexport const CustomDragLayerContainer = styled.div`\r\n  height: 100%;\r\n  left: 0;\r\n  pointer-events: none;\r\n  position: fixed;\r\n  top: 0;\r\n  width: 100%;\r\n  z-index: 100;\r\n`\r\n\r\nexport const DragPreviewWrapper = styled.div.attrs<DragPreviewWrapperProps>(\r\n  ({ position: { x, y } }) => ({\r\n    style: {\r\n      transform: `translate(${ x }px, ${ y }px)`,\r\n    },\r\n  }),\r\n)<DragPreviewWrapperProps>``\r\n\r\nconst rotate360 = keyframes`\r\n  from {\r\n    transform: rotate(0deg);\r\n  }\r\n  to {\r\n    transform: rotate(360deg);\r\n  }\r\n`;\r\n\r\nexport const FlexContainer = styled.div`\r\n  display: flex;\r\n  \r\n  width: 100vw;\r\n  height: 100vh;\r\n  \r\n  align-items: center;\r\n  justify-content: center;\r\n`\r\n\r\nexport const Spinner = styled.div`\r\n  animation: ${ rotate360 } 1s linear infinite;\r\n  transform: translateZ(0);\r\n\r\n  border-top: 2px solid hsl(190deg 70% 80%);;\r\n  border-right: 2px solid hsl(190deg 70% 80%);;\r\n  border-bottom: 2px solid hsl(190deg 70% 80%);\r\n  border-left: 4px solid hsl(190deg 60% 40%);\r\n  background: transparent;\r\n  width: 50px;\r\n  height: 50px;\r\n  border-radius: 50%;\r\n`;","type Item = {\r\n  id: string\r\n}\r\n\r\nexport const findItemIndexById = <TItem extends Item>(\r\n  items: TItem[],\r\n  id: string,\r\n) => {\r\n  return items.findIndex( (item: TItem) => item.id === id )\r\n}\r\n\r\nexport function removeItemAtIndex<TItem>(\r\n  array: TItem[],\r\n  index: number,\r\n){\r\n  return [ ...array.slice( 0, index ), ...array.slice( index + 1 ) ]\r\n}\r\n\r\nexport function insertItemAtIndex<TItem>(\r\n  array: TItem[],\r\n  item: TItem,\r\n  index: number,\r\n){\r\n  return [ ...array.slice( 0, index ), item, ...array.slice( index ) ]\r\n}\r\n\r\nexport const moveItem = <TItem>(\r\n  array: TItem[],\r\n  from: number,\r\n  to: number,\r\n) => {\r\n  const item = array[from]\r\n  return insertItemAtIndex( removeItemAtIndex( array, from ), item, to )\r\n}","import { Action } from './actions'\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport { moveItem } from '../utils/moveItem';\r\nimport { findItemIndexById } from '../utils/arrayUtils';\r\nimport { DragItem } from '../DragItem';\r\n\r\nexport interface Task {\r\n  id: string\r\n  text: string\r\n}\r\n\r\nexport interface List {\r\n  id: string\r\n  text: string\r\n  tasks: Task[]\r\n}\r\n\r\nexport interface AppState {\r\n  lists: List[]\r\n  draggedItem: DragItem | null\r\n}\r\n\r\n\r\n// Here we call the state a draft, because we are using Immer and we’ll mutate this\r\n// object directly. This way we remind ourselves that it is not a regular reducer state\r\n// and we don’t have to worry about the immutability.\r\nexport const appStateReducer = (draft: AppState, action: Action): AppState | void => {\r\n  switch (action.type) {\r\n    case 'ADD_LIST': {\r\n      draft.lists.push( { id: uuidv4(), text: action.payload, tasks: [] } )\r\n      break\r\n    }\r\n    case 'ADD_TASK': {\r\n      const { text, listId } = action.payload\r\n      const targetListIndex = findItemIndexById( draft.lists, listId )\r\n\r\n      draft.lists[targetListIndex].tasks.push( {\r\n        id: uuidv4(),\r\n        text,\r\n      } )\r\n      break\r\n    }\r\n    case 'MOVE_LIST': {\r\n      const { draggedId, hoverId } = action.payload\r\n      const dragIndex = findItemIndexById( draft.lists, draggedId )\r\n      const hoverIndex = findItemIndexById( draft.lists, hoverId )\r\n      draft.lists = moveItem( draft.lists, dragIndex, hoverIndex )\r\n      break\r\n    }\r\n    case 'MOVE_TASK': {\r\n      const {\r\n        draggedItemId,\r\n        hoveredItemId,\r\n        sourceColumnId,\r\n        targetColumnId,\r\n      } = action.payload;\r\n\r\n      const sourceListIndex = findItemIndexById(\r\n        draft.lists,\r\n        sourceColumnId,\r\n      );\r\n\r\n      const targetListIndex = findItemIndexById(\r\n        draft.lists,\r\n        targetColumnId,\r\n      );\r\n\r\n      const dragIndex = findItemIndexById(\r\n        draft.lists[sourceListIndex].tasks,\r\n        draggedItemId,\r\n      )\r\n      // ...\r\n      const hoverIndex = hoveredItemId\r\n        ? findItemIndexById(\r\n          draft.lists[targetListIndex].tasks,\r\n          hoveredItemId,\r\n        )\r\n        : 0\r\n\r\n      const item = draft.lists[sourceListIndex].tasks[dragIndex]\r\n\r\n      // Remove the task from the source list\r\n      draft.lists[sourceListIndex].tasks.splice( dragIndex, 1 )\r\n\r\n      // Add the task to the target list\r\n      draft.lists[targetListIndex].tasks.splice( hoverIndex, 0, item )\r\n\r\n      break\r\n    }\r\n    case 'SET_DRAGGED_ITEM': {\r\n      draft.draggedItem = action.payload\r\n      break\r\n    }\r\n    // default: {\r\n    //   return draft\r\n    // }\r\n  }\r\n}\r\n","//Building Trello with Drag and Drop 77\r\n//We want to be able to work with arrays with any kind of items in them, so we use a\r\n//generic type T.\r\n//Then we calculate the startIndex. We make sure that it�s always a positive number.\r\n//If our destination index is smaller than zero - we use array length plus the destination\r\n//index. We do this because if you pass a negative index to splice function it will begin\r\n//that many elements from the end. So we can end up adding an item to the wrong\r\n//spot.\r\n//After we�ve calculated the startIndex that is always a positive number we can move\r\n//items around. First, we remove the item with the from index and store it in the item\r\n//const. Then we insert that item at startIndex position.\r\n\r\nexport const moveItem = <T>(array: T[], from: number, to: number) => {\r\n  const startIndex = to < 0 ? array.length + to : to;\r\n  const item = array.splice( from, 1 )[0]\r\n  array.splice( startIndex, 0, item )\r\n  return array\r\n}","import React, { useEffect, useState } from 'react'\r\nimport { AppState } from './state/appStateReducer'\r\nimport { load } from './api';\r\nimport { FlexContainer, Spinner } from './styles';\r\n\r\ntype InjectedProps = {\r\n  initialState: AppState\r\n}\r\n\r\ntype PropsWithoutInjected<TBaseProps> = Omit<TBaseProps,\r\n  keyof InjectedProps>\r\n\r\nconst appData: AppState = {\r\n  lists: [\r\n    {\r\n      id: '0',\r\n      text: 'To Do',\r\n      tasks: [ { id: 'c0', text: 'Generate app scaffold' } ],\r\n    },\r\n    {\r\n      id: '1',\r\n      text: 'In Progress',\r\n      tasks: [ { id: 'c2', text: 'Learn Typescript' } ],\r\n    },\r\n    {\r\n      id: '2',\r\n      text: 'Done',\r\n      tasks: [ { id: 'c3', text: 'Begin to use static typing' } ],\r\n    },\r\n  ],\r\n  draggedItem: null,\r\n}\r\n\r\n//We removed the injected props, and then added them back. This might look tautological,\r\n// but it is necessary to let TypeScript know that the wrapped component will accept the\r\n// InjectedProps. TypeScript is very cautious with generic types and if we wouldn't\r\n// perform this trick it wouldn't let us pass the fields defined in the InjectedProps type\r\n// to our component.\r\n\r\nexport function withInitialState<TProps>(\r\n  WrappedComponent: React.ComponentType<PropsWithoutInjected<TProps> & InjectedProps>,\r\n){\r\n  return (props: PropsWithoutInjected<TProps>) => {\r\n    const [ initialState, setInitialState ] = useState<AppState>( {\r\n      lists: [],\r\n      draggedItem: null,\r\n    } )\r\n\r\n    const [ isLoading, setIsLoading ] = useState( true )\r\n    const [ error, setError ] = useState<Error | undefined>()\r\n\r\n    useEffect( () => {\r\n      const fetchInitialState = async () => {\r\n        try {\r\n          const data = await load()\r\n          setInitialState( data )\r\n        } catch (e) {\r\n          setInitialState( appData )\r\n          /*if ( e instanceof Error ) {\r\n            setError( e )\r\n          }*/\r\n        }\r\n        setIsLoading( false )\r\n      }\r\n      fetchInitialState()\r\n    }, [] )\r\n\r\n    if ( isLoading ) {\r\n      return <FlexContainer><Spinner/></FlexContainer>\r\n    }\r\n\r\n    if ( error ) {\r\n      return <div>{ error.message }</div>\r\n    }\r\n\r\n    return <WrappedComponent { ...props } initialState={ initialState }/>\r\n  }\r\n}","import React, { createContext, useContext, useEffect } from 'react'\r\nimport { useImmerReducer } from 'use-immer'\r\nimport { Action } from './actions';\r\nimport { AppState, appStateReducer, List, Task } from './appStateReducer';\r\nimport { DragItem } from '../DragItem';\r\nimport { save } from '../api';\r\nimport { withInitialState } from '../withInitialState';\r\n\r\n\r\ntype AppStateContextProps = {\r\n  lists: Array<List>\r\n  draggedItem: DragItem | null\r\n  getTasksByListId(id: string): Array<Task>\r\n  dispatch: React.Dispatch<Action>\r\n}\r\n\r\ntype AppStateProviderProps = {\r\n  children: React.ReactNode\r\n  initialState: AppState\r\n}\r\n\r\n//React wants us to provide the default value for our context. This value will only\r\n//be used if we don't wrap our application into our AppStateProvider. So we can\r\n//omit it. To do it pass an empty object that we'll cast to AppStateContextProps to\r\n//createContext function. Here we use an as operator to make Typescript think that\r\n//our empty object actually has AppStateContextProps type:\r\nconst AppStateContext = createContext<AppStateContextProps>( {} as AppStateContextProps )\r\n\r\n//We use React.propsWithChildren type.\r\n//It requires one generic argument, but we don't want to have any other props\r\n//so we pass an empty object to it.\r\n\r\nexport const AppStateProvider = withInitialState<AppStateProviderProps>(({ children, initialState }) => {\r\n\r\n  const [ state, dispatch ] = useImmerReducer( appStateReducer, initialState )\r\n  const { draggedItem, lists } = state\r\n\r\n  const getTasksByListId = (id: string) => {\r\n    return lists.find( (list) => list.id === id )?.tasks || []\r\n  }\r\n\r\n  useEffect( () => {\r\n    save( state )\r\n  }, [ state ] )\r\n\r\n  return (\r\n    <AppStateContext.Provider value={ { draggedItem, lists, getTasksByListId, dispatch } }>\r\n      { children }\r\n    </AppStateContext.Provider>\r\n  )\r\n})\r\n\r\nexport const useAppState = () => {\r\n  return useContext( AppStateContext )\r\n}","import { AppState } from './state/appStateReducer'\r\n\r\nexport const save = (payload: AppState) => {\r\n  return fetch( `${ process.env.REACT_APP_BACKEND_ENDPOINT }/save`, {\r\n    method: 'POST',\r\n    headers: {\r\n      Accept: 'application/json',\r\n      'Content-Type': 'application/json',\r\n    },\r\n    body: JSON.stringify( payload ),\r\n  } ).then( (response) => {\r\n    if ( response.ok ) {\r\n      return response.json()\r\n    } else {\r\n      throw new Error( 'Error while saving the state.' )\r\n    }\r\n  } ).catch(error => {\r\n    console.log(error)\r\n  })\r\n}\r\n\r\nexport const load = () => {\r\n  return fetch( `${ process.env.REACT_APP_BACKEND_ENDPOINT }/load` ).then(\r\n    (response) => {\r\n      if ( response.ok ) {\r\n        return response.json() as Promise<AppState>\r\n      } else {\r\n        throw new Error( 'Error while loading the state.' )\r\n      }\r\n    },\r\n  )\r\n}","import { DragItem } from '../DragItem'\r\n\r\nexport const isHidden = (\r\n  draggedItem: DragItem | null,\r\n  itemType: string,\r\n  id: string,\r\n  isPreview?: boolean,\r\n): boolean => {\r\n  return Boolean(\r\n    !isPreview &&\r\n    draggedItem &&\r\n    draggedItem.type === itemType &&\r\n    draggedItem.id === id,\r\n  )\r\n}","import { DragItem } from '../DragItem';\r\n\r\n\r\n//The technique we are using here is called discriminated union.\r\n//Each interface has a type property. This property will be our discriminant. It means\r\n//that Typescript can look at this property and tell what will be the other fields of the\r\n//interface.\r\nexport type Action =\r\n  | {\r\n  type: 'ADD_LIST'\r\n  payload: string\r\n}\r\n  | {\r\n  type: 'ADD_TASK'\r\n  payload: {\r\n    text: string\r\n    listId: string\r\n  }\r\n}\r\n  | {\r\n  type: 'MOVE_LIST'\r\n  payload: {\r\n    draggedId: string\r\n    hoverId: string\r\n  }\r\n}\r\n  | {\r\n  type: 'SET_DRAGGED_ITEM'\r\n  payload: DragItem | null\r\n}\r\n  | {\r\n  type: 'MOVE_TASK'\r\n  payload: {\r\n    draggedItemId: string\r\n    hoveredItemId: string | null\r\n    sourceColumnId: string\r\n    targetColumnId: string\r\n  }\r\n}\r\n\r\n\r\nexport const addTask = (text: string, listId: string): Action => ({\r\n  type: 'ADD_TASK',\r\n  payload: {\r\n    text,\r\n    listId,\r\n  },\r\n})\r\n\r\nexport const addList = (text: string): Action => ({\r\n  type: 'ADD_LIST',\r\n  payload: text,\r\n})\r\n\r\nexport const moveList = (draggedId: string, hoverId: string): Action => ({\r\n  type: 'MOVE_LIST',\r\n  payload: {\r\n    draggedId,\r\n    hoverId,\r\n  },\r\n})\r\n\r\nexport const setDraggedItem = (draggedItem: DragItem | null): Action => ({\r\n  type: 'SET_DRAGGED_ITEM',\r\n  payload: draggedItem,\r\n})\r\n\r\nexport const moveTask = (\r\n  draggedItemId: string,\r\n  hoveredItemId: string | null,\r\n  sourceColumnId: string,\r\n  targetColumnId: string,\r\n): Action => ({\r\n  type: 'MOVE_TASK',\r\n  payload: {\r\n    draggedItemId,\r\n    hoveredItemId,\r\n    sourceColumnId,\r\n    targetColumnId,\r\n  },\r\n})","import { useEffect } from 'react'\r\nimport { useDrag } from 'react-dnd'\r\nimport { getEmptyImage } from 'react-dnd-html5-backend'\r\nimport { useAppState } from '../state/AppStateContext';\r\nimport { DragItem } from '../DragItem';\r\nimport { setDraggedItem } from '../state/actions';\r\n\r\n\r\nexport const useItemDrag = (item: DragItem) => {\r\n  const { dispatch } = useAppState()\r\n  const [ , drag, preview ] = useDrag( {\r\n    type: item.type,\r\n    item: () => {\r\n      dispatch( setDraggedItem( item ) )\r\n      return item\r\n    },\r\n    end: () => dispatch( setDraggedItem( null ) ),\r\n  } )\r\n\r\n  useEffect( () => {\r\n    preview( getEmptyImage(), { captureDraggingState: true } )\r\n  }, [ preview ] )\r\n\r\n  return { drag }\r\n}","import React, { useRef } from 'react'\r\nimport { CardContainer } from '../../styles'\r\nimport { ICardProps } from './Card.props';\r\nimport { useAppState } from '../../state/AppStateContext';\r\nimport { isHidden } from '../../utils/isHidden';\r\nimport { useItemDrag } from '../../utils/useItemDrag';\r\nimport { useDrop } from 'react-dnd';\r\nimport { moveTask, setDraggedItem } from '../../state/actions';\r\nimport { throttle } from 'throttle-debounce-ts';\r\n\r\n\r\nexport const Card = ({ text, id, columnId, isPreview }: ICardProps): JSX.Element => {\r\n  const { draggedItem, dispatch } = useAppState()\r\n  const ref = useRef<HTMLDivElement>( null )\r\n\r\n  const { drag } = useItemDrag( {\r\n    type: 'CARD',\r\n    id,\r\n    text,\r\n    columnId,\r\n  } )\r\n\r\n  const [ , drop ] = useDrop( {\r\n    accept: 'CARD',\r\n    hover: throttle( 200, () => {\r\n      if ( !draggedItem ) {\r\n        return\r\n      }\r\n      if ( draggedItem.type !== 'CARD' ) {\r\n        return\r\n      }\r\n      if ( draggedItem.id === id ) {\r\n        return\r\n      }\r\n\r\n      dispatch(\r\n        moveTask( draggedItem.id, id, draggedItem.columnId, columnId ),\r\n      )\r\n      dispatch( setDraggedItem( { ...draggedItem, columnId } ) )\r\n    } ),\r\n  } )\r\n\r\n  drag(drop(ref))\r\n\r\n  return (\r\n    <CardContainer\r\n      isHidden={ isHidden( draggedItem, 'CARD', id, isPreview ) }\r\n      isPreview={ isPreview }\r\n      ref={ ref }\r\n    >\r\n      { text }\r\n    </CardContainer>\r\n  )\r\n}","import React, { useState } from 'react'\r\nimport { NewItemButton, NewItemFormContainer, NewItemInput } from '../../styles'\r\nimport { useFocus } from '../../utils/useFocus'\r\nimport { INewItemFormProps } from './NewItemForm.props'\r\n\r\nexport const NewItemForm = ({ onAdd }: INewItemFormProps) => {\r\n  const [ text, setText ] = useState( '' )\r\n  const handleAddText = (ev: React.KeyboardEvent<HTMLInputElement>) => {\r\n    if ( ev.key === 'Enter' ) {\r\n      onAdd( text )\r\n    }\r\n  }\r\n  const inputRef = useFocus()\r\n  return (\r\n    <NewItemFormContainer>\r\n      <NewItemInput\r\n        ref={ inputRef }\r\n        value={ text }\r\n        onChange={ e => setText( e.target.value ) }\r\n        onKeyPress={handleAddText}\r\n      />\r\n      <NewItemButton onClick={ () => onAdd( text ) }>\r\n        Create\r\n      </NewItemButton>\r\n    </NewItemFormContainer>\r\n  )\r\n}\r\n\r\n","import { useLayoutEffect, useRef } from 'react'\r\n\r\nexport const useFocus = () => {\r\n    const ref = useRef<HTMLInputElement>(null)\r\n    useLayoutEffect(() => {\r\n        ref.current?.focus()\r\n    })\r\n    return ref\r\n}","import React, { useState } from 'react'\r\nimport { AddItemButton } from '../../styles'\r\nimport { NewItemForm } from '../NewItemForm/';\r\nimport { IAddNewItemProps } from './AddNewItem.props';\r\n\r\nexport const AddNewItem = (props: IAddNewItemProps): JSX.Element => {\r\n  const [ showForm, setShowForm ] = useState( false );\r\n  const { onAdd, toggleButtonText, dark } = props;\r\n  if ( showForm ) {\r\n    return (\r\n      <NewItemForm\r\n        onAdd={ text => {\r\n          onAdd( text )\r\n          setShowForm( false )\r\n        } }/>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <AddItemButton\r\n      dark={ dark }\r\n      onClick={ () => setShowForm( true ) }\r\n    >\r\n      { toggleButtonText }\r\n    </AddItemButton>\r\n  )\r\n}","import React, { useRef } from 'react'\r\nimport { useDrop } from 'react-dnd'\r\nimport { throttle } from 'throttle-debounce-ts'\r\n\r\nimport { ColumnContainer, ColumnTitle } from '../../styles'\r\nimport { IColumnProps } from './Column.props';\r\nimport { Card } from '../Card/';\r\nimport { AddNewItem } from '../AddNewItem';\r\n\r\nimport { useAppState } from '../../state/AppStateContext';\r\nimport { addTask, moveList, moveTask, setDraggedItem } from '../../state/actions';\r\nimport { useItemDrag } from '../../utils/useItemDrag';\r\nimport { isHidden } from '../../utils/isHidden';\r\n\r\n\r\nexport const Column = ({ text, id, isPreview }: IColumnProps): JSX.Element => {\r\n  const { draggedItem, getTasksByListId, dispatch } = useAppState()\r\n  const tasks = getTasksByListId( id )\r\n  const ref = useRef<HTMLDivElement>( null )\r\n  const [ , drop ] = useDrop( {\r\n    accept: [ 'COLUMN', 'CARD' ],\r\n    hover: throttle( 200, () => {\r\n      if ( !draggedItem ) return\r\n\r\n      if ( draggedItem.type === 'COLUMN' ) {\r\n        if ( draggedItem.id === id ) return\r\n\r\n        dispatch( moveList( draggedItem.id, id ) )\r\n      } else {\r\n        if ( draggedItem.columnId === id ) {\r\n          return\r\n        }\r\n        if ( tasks.length ) {\r\n          return\r\n        }\r\n\r\n        dispatch( moveTask( draggedItem.id, null, draggedItem.columnId, id ) )\r\n        dispatch( setDraggedItem( { ...draggedItem, columnId: id } ) )\r\n      }\r\n    } ),\r\n  } )\r\n\r\n  const { drag } = useItemDrag( { type: 'COLUMN', id, text } )\r\n\r\n  drag( drop( ref ) )\r\n  return (\r\n    <ColumnContainer\r\n      ref={ ref }\r\n      isPreview={ isPreview }\r\n      isHidden={ isHidden( draggedItem, 'COLUMN', id, isPreview ) }\r\n    >\r\n      <ColumnTitle>{ text }</ColumnTitle>\r\n      { tasks.map( (task) => (\r\n        <Card columnId={ id } text={ task.text } key={ task.id } id={ task.id }/>\r\n      ) ) }\r\n      <AddNewItem\r\n        toggleButtonText=\"+ Add another card\"\r\n        onAdd={ (text) => dispatch( addTask( text, id ) ) }\r\n        dark\r\n      />\r\n    </ColumnContainer>\r\n  )\r\n}","import { useAppState } from './state/AppStateContext';\r\nimport { useDragLayer } from 'react-dnd'\r\nimport { Column } from './components/Column';\r\nimport { Card } from './components/Card';\r\nimport { CustomDragLayerContainer, DragPreviewWrapper } from './styles';\r\n\r\nexport const CustomDragLayer = () => {\r\n  const { draggedItem } = useAppState()\r\n  const { currentOffset } = useDragLayer( (monitor) => ({\r\n    currentOffset: monitor.getSourceClientOffset(),\r\n  }) )\r\n\r\n  return draggedItem && currentOffset ? (\r\n    <CustomDragLayerContainer>\r\n      <DragPreviewWrapper position={ currentOffset }>\r\n        { draggedItem.type === 'COLUMN' ? (\r\n          <Column\r\n            id={ draggedItem.id }\r\n            text={ draggedItem.text }\r\n            isPreview\r\n          />\r\n        ) : (\r\n          <Card\r\n            columnId={ draggedItem.columnId }\r\n            isPreview\r\n            id={ draggedItem.id }\r\n            text={ draggedItem.text }\r\n          />\r\n        ) }\r\n      </DragPreviewWrapper>\r\n    </CustomDragLayerContainer>\r\n  ) : null\r\n}","import React from 'react'\r\nimport { AppContainer } from './styles'\r\nimport { Column } from './components/Column/';\r\nimport { AddNewItem } from './components/AddNewItem/';\r\nimport { useAppState } from './state/AppStateContext';\r\nimport { addList } from \"./state/actions\"\r\nimport { CustomDragLayer } from './CustomDragLayer';\r\n\r\nconst App = () => {\r\n  const { lists , dispatch } = useAppState()\r\n\r\n  return (\r\n    <AppContainer>\r\n      <CustomDragLayer />\r\n      { lists.map( (list) => (\r\n        <Column text={ list.text } key={ list.id } id={ list.id }/>\r\n      ) ) }\r\n      <AddNewItem\r\n        toggleButtonText=\"+ Add another list\"\r\n        onAdd={(text) => dispatch(addList(text))}\r\n      />\r\n    </AppContainer>\r\n  )\r\n}\r\n\r\nexport default App;","import React from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport './index.css'\r\nimport App from './App'\r\nimport { HTML5Backend as Backend } from 'react-dnd-html5-backend'\r\nimport { DndProvider } from 'react-dnd'\r\nimport { AppStateProvider } from './state/AppStateContext';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <DndProvider backend={ Backend }>\r\n      <AppStateProvider>\r\n        <App/>\r\n      </AppStateProvider>\r\n    </DndProvider>\r\n  </React.StrictMode>,\r\n  document.getElementById( 'root' ),\r\n)"],"sourceRoot":""}